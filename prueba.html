<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Subir MP3 a Cloudinary</title>
  </head>
  <body>
    <h1>Subir un archivo MP3 a Cloudinary</h1>

    <!-- Formulario de carga -->
    <input type="file" id="audio-file" accept="audio/mp3" />
    <button onclick="uploadAudio()">Subir Audio</button>

    <!-- Div para mostrar la respuesta -->
    <div id="audio-info"></div>
    <div id="mp3-list"></div>

    <!-- Script de carga con Cloudinary -->
    <script>
      // Cambia 'tu_nombre_de_cuenta' con el nombre de tu cuenta en Cloudinary
      const cloudinaryUrl = "https://api.cloudinary.com/v1_1/dzp7kwxjt/upload";
      const cloudinaryPreset = "audiosmusic"; // Asegúrate de que este preset esté configurado en Cloudinary

      // Función para subir el archivo de audio
      function uploadAudio() {
        const fileInput = document.getElementById("audio-file");
        const file = fileInput.files[0];

        if (!file) {
          alert("Por favor selecciona un archivo de audio");
          return;
        }

        const formData = new FormData();
        formData.append("file", file);
        formData.append("upload_preset", cloudinaryPreset);

        fetch(cloudinaryUrl, {
          method: "POST",
          body: formData,
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.error) {
              console.error("Error de Cloudinary:", data.error);
              alert("Error: " + data.error.message);
            } else {
              const audioUrl = data.secure_url;
              document.getElementById("audio-info").innerHTML = `
        <p>Audio subido con éxito:</p>
        <audio controls>
          <source src="${audioUrl}" type="audio/mp3">
          Tu navegador no soporta el elemento de audio.
        </audio>
        <p>URL del archivo: <a href="${audioUrl}" target="_blank">${audioUrl}</a></p>
      `;
            }
          })
          .catch((error) => {
            console.error("Error al subir el archivo:", error);
            alert("Hubo un error al subir el archivo");
          });
      }

      // Función para obtener y mostrar todos los archivos MP3
      const axios = require("axios");
      const cloudinaryApiUrl =
        "https://api.cloudinary.com/v1_1/dzp7kwxjt/resources/raw?max_results=30"; // URL correcta para los recursos
      const apiKey = "925661535445365"; // Usa tu API Key de Cloudinary
      const apiSecret = "T7OxDB8P66A1KIbX9fpIfORdtlo"; // Usa tu API Secret de Cloudinary

      async function fetchMP3Files() {
        try {
          // Realizamos la solicitud con autenticación básica
          const response = await axios.get(cloudinaryApiUrl, {
            auth: {
              username: apiKey,
              password: apiSecret,
            },
          });

          // Filtra solo los archivos MP3
          const mp3Files = response.data.resources.filter(
            (file) => file.format === "mp3"
          );

          console.log("Archivos MP3:", mp3Files);
        } catch (error) {
          console.error("Error al obtener archivos MP3:", error);
        }
      }

      fetchMP3Files();
    </script>
  </body>
</html>
